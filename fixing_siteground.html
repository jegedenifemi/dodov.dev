<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fixing_siteground</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="./build.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/x-icon"
      sizes="16x16 32x32"
      href="https://dodov.dev/media/site/7c35252aa6-1640615600/favicon-dark-plus.png"
      id="favicon"
    />
  </head>

  <body>
    <div class="wrapper">
      <nav>
        <ul>
          <a href="./index.html"><li class="home">home</li></a>
          <a href="./blog.html"><li class="blog">blog</li></a>
          <li class="dont_build active_tab">
            fixing-siteground-dynamic-cache-issues
            <a href="./blog.html" class="tab_close" title="Close Article">x</a>
          </li>
          <a href="./projects.html"><li class="projects">projects</li></a>
        </ul>
      </nav>

      <div class="main">
        <div class="num_line">
          <a href="#"><p>1</p></a>
          <a href="#"><p>2</p></a>
          <a href="#"><p>3</p></a>
          <a href="#"><p>4</p></a>
          <a href="#"><p>5</p></a>
          <a href="#"><p>6</p></a>
          <a href="#"><p>7</p></a>
          <a href="#"><p>8</p></a>
          <a href="#"><p>9</p></a>
          <a href="#"><p>10</p></a>
          <a href="#"><p>11</p></a>
          <a href="#"><p>12</p></a>
          <a href="#"><p>13</p></a>
          <a href="#"><p>14</p></a>
          <a href="#"><p>15</p></a>
          <a href="#"><p>16</p></a>
          <a href="#"><p>17</p></a>
          <a href="#"><p>18</p></a>
          <a href="#"><p>19</p></a>
          <a href="#"><p>20</p></a>
          <a href="#"><p>21</p></a>
          <a href="#"><p>22</p></a>
          <a href="#"><p>23</p></a>
          <a href="#"><p>24</p></a>
          <a href="#"><p>25</p></a>
          <a href="#"><p>26</p></a>
          <a href="#"><p>27</p></a>
          <a href="#"><p>28</p></a>
          <a href="#"><p>29</p></a>
          <a href="#"><p>30</p></a>
          <a href="#"><p>31</p></a>
          <a href="#"><p>33</p></a>
          <a href="#"><p>33</p></a>
          <a href="#"><p>34</p></a>
          <a href="#"><p>35</p></a>
          <a href="#"><p>36</p></a>
          <a href="#"><p>37</p></a>
          <a href="#"><p>38</p></a>
          <a href="#"><p>39</p></a>
          <a href="#"><p>40</p></a>
          <a href="#"><p>41</p></a>
          <a href="#"><p>42</p></a>
          <a href="#"><p>43</p></a>
          <a href="#"><p>44</p></a>
          <a href="#"><p>45</p></a>
          <a href="#"><p>46</p></a>
          <a href="#"><p>47</p></a>
          <a href="#"><p>48</p></a>
          <a href="#"><p>49</p></a>
          <a href="#"><p>50</p></a>
          <a href="#"><p>51</p></a>
          <a href="#"><p>52</p></a>
          <a href="#"><p>53</p></a>
          <a href="#"><p>54</p></a>
          <a href="#"><p>55</p></a>
          <a href="#"><p>56</p></a>
          <a href="#"><p>57</p></a>
          <a href="#"><p>58</p></a>
          <a href="#"><p>59</p></a>
          <a href="#"><p>60</p></a>
          <a href="#"><p>61</p></a>
          <a href="#"><p>62</p></a>
          <a href="#"><p>63</p></a>
          <a href="#"><p>64</p></a>
          <a href="#"><p>65</p></a>
          <a href="#"><p>66</p></a>
          <a href="#"><p>67</p></a>
          <a href="#"><p>68</p></a>
          <a href="#"><p>69</p></a>
          <a href="#"><p>70</p></a>
          <a href="#"><p>71</p></a>
          <a href="#"><p>72</p></a>
          <a href="#"><p>73</p></a>
          <a href="#"><p>74</p></a>
          <a href="#"><p>75</p></a>
          <a href="#"><p>76</p></a>
          <a href="#"><p>77</p></a>
          <a href="#"><p>78</p></a>
          <a href="#"><p>79</p></a>
          <a href="#"><p>80</p></a>
          <a href="#"><p>81</p></a>
          <a href="#"><p>82</p></a>
          <a href="#"><p>83</p></a>
          <a href="#"><p>84</p></a>
          <a href="#"><p>85</p></a>
          <a href="#"><p>86</p></a>
          <a href="#"><p>88</p></a>
          <a href="#"><p>88</p></a>
          <a href="#"><p>89</p></a>
          <a href="#"><p>90</p></a>
          <a href="#"><p>91</p></a>
          <a href="#"><p>92</p></a>
          <a href="#"><p>93</p></a>
          <a href="#"><p>94</p></a>
          <a href="#"><p>95</p></a>
          
        </div>

        <article>
          <header>
            <div class="header_left">
              <h1>Fixing SiteGround Dynamic Cache Issues</h1>
              <p>
                That's what you get for not using WordPress…
              </p>
            </div>
            <div class="header_right">
              <p title="Sunday,June 12,2022, 13:00 EEST">12 Jun 2022</p>
              <p>100 lines</p>
            </div>
          </header>

          <img
            src="./img/siteground.png"
            alt="Terminal command (rm -rf
          .git), surrounded by random characters."
            id="img1"
          />
          <div id="modal1" class="modal1">
            <img
              src="./img/siteground.png"
              alt="Terminal command (rm -rf
          .git), surrounded by random characters."
            />
          </div>

          <p>
            If your website is hosted on SiteGround and you have strange issues, such as clicking on 
            a button and nothing happening, it could be a cache issue. By default, 
            SiteGround caches all requests, as they've said in <a href="#" class="link">their help center article</a>:
          </p>

          <br />

          <ul style="color:rgb(124, 119, 119);">
            <li class="list_items">
              <div><p>Our Dynamic caching is a full-page caching mechanism powered</p></div>
            </li>
            <li class="list_items">
              <div>
                <p>by NGINX that's enabled and running by default on all</p>
              </div>
            </li>
            <li class="list_items">
                <div><p>SiteGround servers.</p></div>
              </li>
          </ul>
          <br />

          <p>
            The problem is that everything is cached, including the raw HTML of your pages and AJAX requests made by either your front-end, admin panel, or whatever. 
            There also appears to be no way to simply turn off this functionality.</p>

            <br />
          

          <p>
            In my case, I'm using Kirby CMS and this aggressive caching means that 
            if I change the status of a blog post from <i>Draft</i> to Public, it actually happens 
            at a filesystem level, but since the HTML of the blog is cached, the article doesn't appear. 
            Because AJAX requests are <i>also</i> cached, the Kirby panel front-end isn't updated as well, 
            leaving no indication that something actually happened.
          </p>

          <br />

          <p>
            SiteGround has built-in exceptions for the cache. For example, 
            if a visitor has the <span style="color:rgb(245, 121, 63)">wordpress_logged_in_</span> or 
            <span style="color:rgb(245, 121, 63)"></span>Drupal.visitor.name</span> cookie, 
            they'll bypass the cache and see all changes they make immediately. However, 
            if you're using something other than WordPress or Drupal, like me, you're screwed.
          </p>

          <br />

          <p>
            Luckily, SiteGround respects <span style="color:rgb(245, 121, 63)">Cache-Control</span><a href="#" class="link">headers</a>that your server sends. 
            You can turn off the cache entirely by adding the following in your main <span style="color:rgb(245, 121, 63)">index.php</span> file:
          </p>

          <br />

          <p>
            <span style="color:rgb(40, 196, 207)">header</span>('Cache-Control: no-cache');
          </p>

          <br />

          <p>
            Alternatively, in case of using Kirby, 
            you could disable it for just the panel by matching the request path with regex:
          </p>

          <br />

          <p>
            <span style="color:rgb(240, 32, 118)">if </span>(preg_match(<span style="color:rgb(168, 152, 5)">'~^/(panel|api)(/|\?|$)~'</span>, $_SERVER[<span style="color:rgb(168, 152, 5)">'REQUEST_URI'</span>])) {
                header('Cache-Control: no-cache');
            }
          </p>

          <br />

          <p>
            You can check if this works by inspecting the response headers and looking for the x-proxy-cache header. 
            It tells whether the response was served by the cache or not. If you see the following, the response was not cached:
          </p>

          <br />

          <p>
            x-proxy-cache: MISS
          </p>

          <br />


          <h2>Handling Cloudflare Cache</h2><br />

          <p>
            Things can be even more confusing if you use Cloudflare, due to its own caching functionality. 
            It has to be enabled explicitly and only caches static files by default, 
            so it has less unpleasant surprises. In my opinion, it doesn't make much sense to have both caches enabled, 
            so you should probably disable one or the other. You can determine the Cloudflare cache status by looking at the <span style="color:rgb(245, 121, 63)">cf-cache-status</span> header.
          </p>

          
          <p>
            The response is cached by Cloudflare if you have these headers:
          </p>

          <br />
          <br />

          <ul>
            <li>
              <div>
                <p>
                    cf-cache-status: HIT
                </p>
              </div>
            </li>
            <li>
              <div>
                <p>
                    x-proxy-cache: MISS
                </p>
              </div>
            </li>
          </ul>

          <br />

          <br />

         
          <p>
            …and you get these headers if it's cached by SiteGround instead:
          </p>
          <br />

          <ul>
            <li>
              <div>
                <p>
                    cf-cache-status: DYNAMIC
                </p>
              </div>
            </li>
            <li>
              <div>
                <p>
                    x-proxy-cache: HIT
                </p>
              </div>
            </li>
          </ul>

          <br />
          <br />
        </article>

        <div class="separator">
          <span>//</span>
          <hr />
        </div>

        <div class="foot">
          <ul class="foot_links">
            <li><a class="link">GitHub</a></li>
            <span>•</span>
            <li><a class="link">Twitter</a></li>
            <span>•</span>
            <li><a class="link">LinkedIn</a></li>
            <span>•</span>
            <li><a class="link">Instagram</a></li>
          </ul>

          <div class="foot_theme">
            <select name="theme" id="theme">
              <option value="dark" id="dark">Dark +</option>
              <option value="light" id="light">Light +</option>
              <option value="monokai">Monokai</option>
              <option value="g-dark">GitHub Dark</option>
              <option value="g-light">GitHub Light</option>
              <option value="slrzd light">Solarized Light</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <script src="./index.js"></script>
  </body>
</html>
